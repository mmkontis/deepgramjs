<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="noindex" />
    <title>WebSocket Microphone Streaming</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #000000;
        font-family: Arial, sans-serif;
      }
      #blobContainer {
        width: 300px;
        height: 300px;
        position: relative;
        overflow: hidden;
        border-radius: 50%;
      }
      #blobCanvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }
      #micButton, #closeButton {
        position: absolute;
        bottom: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background-color: #333;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: background-color 0.2s ease;
      }
      #micButton {
        left: 20px;
      }
      #closeButton {
        right: 20px;
      }
      #micButton img, #closeButton img {
        width: 30px;
        height: 30px;
      }
    </style>
  </head>
  <body>
    <div id="blobContainer">
      <canvas id="blobCanvas"></canvas>
    </div>
    <div id="micButton">
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.91-3c-.49 0-.9.36-.98.85C16.52 14.2 14.47 16 12 16s-4.52-1.8-4.93-4.15c-.08-.49-.49-.85-.98-.85-.61 0-1.09.54-1 1.14.49 3 2.89 5.35 5.91 5.78V20c0 .55.45 1 1 1s1-.45 1-1v-2.08c3.02-.43 5.42-2.78 5.91-5.78.1-.6-.39-1.14-1-1.14z'/%3E%3C/svg%3E" alt="Microphone">
    </div>
    <div id="closeButton">
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/%3E%3C/svg%3E" alt="Close">
    </div>

    <script>
      let isListening = false;
      let audioContext;
      let analyser;
      let microphone;
      let animationId;

      window.onload = function() {
        const blobCanvas = document.getElementById('blobCanvas');
        const ctx = blobCanvas.getContext('2d');
        const micButton = document.getElementById('micButton');
        const closeButton = document.getElementById('closeButton');

        blobCanvas.width = 300;
        blobCanvas.height = 300;

        micButton.addEventListener('click', toggleListening);
        closeButton.addEventListener('click', stopListening);

        function toggleListening() {
          if (isListening) {
            stopListening();
          } else {
            startListening();
          }
        }

        function startListening() {
          if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 256;
          }

          navigator.mediaDevices.getUserMedia({ audio: true })
            .then(stream => {
              microphone = audioContext.createMediaStreamSource(stream);
              microphone.connect(analyser);
              isListening = true;
              micButton.style.backgroundColor = '#ff0000';
              animateWatercolor();
            })
            .catch(error => console.error('Error accessing microphone:', error));
        }

        function stopListening() {
          if (microphone) {
            microphone.disconnect();
            microphone = null;
          }
          isListening = false;
          micButton.style.backgroundColor = '#333';
          cancelAnimationFrame(animationId);
          ctx.clearRect(0, 0, blobCanvas.width, blobCanvas.height);
        }

        function animateWatercolor() {
          ctx.clearRect(0, 0, blobCanvas.width, blobCanvas.height);
          
          const bufferLength = analyser.frequencyBinCount;
          const dataArray = new Uint8Array(bufferLength);
          analyser.getByteFrequencyData(dataArray);

          const average = dataArray.reduce((a, b) => a + b) / bufferLength;
          const radius = 140 + average * 0.3;

          // Create a circular mask
          ctx.beginPath();
          ctx.arc(150, 150, radius, 0, Math.PI * 2);
          ctx.closePath();
          ctx.clip();

          // Create watercolor effect
          const time = Date.now() * 0.001;
          for (let i = 0; i < 5; i++) {
            const hue = (200 + i * 10 + time * 10) % 360; // Cycle through blue hues
            ctx.fillStyle = `hsla(${hue}, 70%, ${70 - i * 10}%, ${0.1 + i * 0.05})`;
            
            ctx.beginPath();
            for (let angle = 0; angle < Math.PI * 2; angle += 0.1) {
              const x = 150 + (radius - i * 20) * Math.cos(angle) + Math.sin(time + i) * 20;
              const y = 150 + (radius - i * 20) * Math.sin(angle) + Math.cos(time + i) * 20;
              ctx.lineTo(x, y);
            }
            ctx.closePath();
            ctx.fill();
          }

          // Add white highlights
          for (let i = 0; i < 20; i++) {
            const x = Math.random() * 300;
            const y = Math.random() * 300;
            const size = Math.random() * 30 + 10;
            const gradient = ctx.createRadialGradient(x, y, 0, x, y, size);
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI * 2);
            ctx.fillStyle = gradient;
            ctx.fill();
          }

          animationId = requestAnimationFrame(animateWatercolor);
        }
      };
    </script>
  </body>
</html>